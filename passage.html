<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章导航 —— npp-zep</title>
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
    <link rel="icon" type="image/x-icon" href="https://avatars.githubusercontent.com/u/206399566?v=4">
    <style>
        /* 背景图片样式 - 与index.html保持一致 */
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: opacity 0.5s ease;
        }
        
        .bg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 25, 47, 0.3);
            backdrop-filter: blur(3px);
            z-index: 1;
        }
        
        .bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
            filter: blur(1px);
            transition: opacity 0.5s ease;
        }
        
        .bg-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--highlight-color);
            color: var(--primary-color);
            border: none;
            cursor: pointer;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
        }
        
        .bg-toggle:hover {
            transform: scale(1.1);
        }
        
        [data-theme="light"] .bg-overlay {
            background: rgba(255, 255, 255, 0.15);
        }
        
        [data-theme="light"] .bg-image {
            opacity: 0.9;
            filter: blur(0.5px);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1.5rem;
        }
        
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--highlight-color);
            object-fit: cover;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }
        
        .avatar:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }
        
        .markdown-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }
        
        .markdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
        }
        
        .back-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--highlight-color);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }
        
        .back-btn:hover {
            background: var(--highlight-color);
            color: var(--primary-color);
        }
        
        .markdown-title {
            margin: 0;
            color: var(--highlight-color);
            font-size: 1.3rem;
            text-align: center;
            flex: 1;
        }
        
        .markdown-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }
        
        .action-btn:hover {
            border-color: var(--highlight-color);
            color: var(--highlight-color);
        }
        
        .markdown-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .markdown-sidebar {
            width: 280px;
            background: var(--secondary-color);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        .markdown-sidebar.hidden {
            transform: translateX(-100%);
            width: 0;
            padding: 0;
            border-right: none;
        }
        
        .markdown-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            line-height: 1.8;
            font-size: 1.05rem;
        }
        
        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3,
        .markdown-content h4,
        .markdown-content h5,
        .markdown-content h6 {
            color: var(--highlight-color);
            margin-top: 1.8rem;
            margin-bottom: 0.8rem;
            font-weight: 500;
            padding-bottom: 0.3rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .markdown-content h1 { font-size: 2rem; }
        .markdown-content h2 { font-size: 1.7rem; }
        .markdown-content h3 { font-size: 1.4rem; }
        .markdown-content h4 { font-size: 1.2rem; }
        .markdown-content h5 { font-size: 1.1rem; }
        .markdown-content h6 { font-size: 1rem; }
        
        .markdown-content p {
            margin: 1rem 0;
            color: var(--text-color);
        }
        
        .markdown-content ul,
        .markdown-content ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }
        
        .markdown-content li {
            margin: 0.5rem 0;
            color: var(--text-secondary);
        }
        
        .markdown-content blockquote {
            border-left: 4px solid var(--highlight-color);
            padding: 0.5rem 1rem;
            margin: 1rem 0;
            background: var(--card-bg);
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .markdown-content code {
            background: var(--secondary-color);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: var(--highlight-color);
        }
        
        .markdown-content pre {
            background: var(--secondary-color);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
        }
        
        .markdown-content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }
        
        .markdown-content th,
        .markdown-content td {
            border: 1px solid var(--border-color);
            padding: 0.8rem;
            text-align: left;
        }
        
        .markdown-content th {
            background: var(--card-bg);
            color: var(--highlight-color);
            font-weight: 600;
        }
        
        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
        }
        
        .markdown-content a {
            color: var(--highlight-color);
            text-decoration: none;
            border-bottom: 1px dotted var(--highlight-color);
        }
        
        .markdown-content a:hover {
            border-bottom-style: solid;
        }
        
        .markdown-content hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 2rem 0;
        }
        
        .toc-title {
            color: var(--highlight-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .toc-list {
            list-style: none;
            padding-left: 0;
        }
        
        .toc-item {
            margin: 0.5rem 0;
        }
        
        .toc-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            display: block;
            padding: 0.3rem 0.5rem;
            border-radius: 4px;
        }
        
        .toc-link:hover {
            color: var(--highlight-color);
            background: var(--card-bg);
        }
        
        .toc-level-2 { padding-left: 1rem; }
        .toc-level-3 { padding-left: 2rem; }
        .toc-level-4 { padding-left: 3rem; }
        
        .theme-options {
            margin-top: 2rem;
        }
        
        .theme-options h4 {
            color: var(--highlight-color);
            margin-bottom: 0.5rem;
        }
        
        .theme-select {
            width: 100%;
            padding: 0.5rem;
            background: var(--primary-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .markdown-sidebar {
                position: fixed;
                top: 60px;
                left: 0;
                height: calc(100% - 60px);
                z-index: 1001;
                box-shadow: var(--shadow-lg);
            }
            
            .markdown-header {
                padding: 1rem;
            }
            
            .markdown-content {
                padding: 1rem;
            }
            
            .markdown-title {
                font-size: 1.1rem;
                margin: 0 0.5rem;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
        }
        
        .articles-section {
            margin-top: 2.5rem;
        }
        
        .articles-section h3 {
            color: var(--highlight-color);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .articles-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .article-card {
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-color: var(--highlight-color);
        }
        
        .article-header {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .article-title {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-color);
            margin: 0;
        }
        
        .article-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .article-meta i {
            margin-right: 0.3rem;
        }
        
        .article-description {
            color: var(--text-secondary);
            line-height: 1.6;
            flex-grow: 1;
            margin: 0;
        }
        
        .article-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
        }
        
        .article-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }
        
        .article-tag {
            font-size: 0.75rem;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            background: var(--accent-color);
            color: var(--text-color);
        }
        
        .tag-web { background: rgba(59, 130, 246, 0.2); }
        .tag-lua { background: rgba(0, 154, 216, 0.2); }
        .tag-python { background: rgba(53, 114, 165, 0.2); }
        .tag-tutorial { background: rgba(16, 185, 129, 0.2); }
        .tag-note { background: rgba(245, 158, 11, 0.2); }
        .tag-c { background: rgba(139, 92, 246, 0.2); }
        
        .article-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .article-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .article-btn:hover {
            background: var(--highlight-color);
            color: var(--primary-color);
            border-color: var(--highlight-color);
        }
        
        .filter-section {
            margin: 1.5rem 0;
        }
        
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: var(--secondary-color);
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .filter-btn:hover {
            border-color: var(--highlight-color);
            color: var(--highlight-color);
        }
        
        .filter-btn.active {
            background: var(--highlight-color);
            color: var(--primary-color);
            border-color: var(--highlight-color);
        }
        
        .stats-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            margin-top: 1.5rem;
            width: 100%;
        }
        
        .stats-card h4 {
            color: var(--highlight-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--highlight-color);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.2rem;
        }
        
        .info-section h3 {
            color: var(--highlight-color);
            margin: 1.5rem 0 0.8rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .loading-articles {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(100, 255, 218, 0.1);
            border-radius: 50%;
            border-top-color: var(--highlight-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }
        
        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            margin: 2rem 0;
            color: var(--text-color);
        }
        
        .error-message i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #ff6b6b;
        }
        
        @media (max-width: 768px) {
            .articles-list {
                grid-template-columns: 1fr;
            }
            
            .article-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .article-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .filter-buttons {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bg-toggle {
                top: 15px;
                right: 15px;
                width: 36px;
                height: 36px;
            }
        }
        
        @media (max-width: 480px) {
            .article-meta {
                flex-direction: column;
                gap: 0.3rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-buttons {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="bg-container" id="bgContainer">
        <div class="bg-overlay"></div>
        <img src="assets/pic/bg.png" alt="背景" class="bg-image" id="bgImage">
        <button class="bg-toggle" id="bgToggle" title="切换背景显示">
            <i class="fas fa-eye"></i>
        </button>
    </div>

    <div class="container">
        <header>
            <h1>文章导航
                <small>知识分享 · 学习笔记</small>
            </h1>
            <p class="tagline">记录思考，分享见解</p>
        </header>

        <main class="main-content">
            <section class="description">
                <div class="profile-header">
                    <img src="https://avatars.githubusercontent.com/u/206399566?v=4" alt="头像" class="avatar">
                    <h2>我的文章</h2>
                </div>
                
                <div class="info-section">
                    <h3><i class="fas fa-info-circle"></i> 说明</h3>
                    <p>这里是我在学习过程中整理的笔记和心得分享，内容涵盖编程技术、学习方法和项目经验等。所有文章都以Markdown格式编写，支持代码高亮和目录导航。</p>
                    
                    <h3><i class="fas fa-filter"></i> 筛选文章</h3>
                    <div class="filter-section">
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-filter="all">全部文章</button>
                            <button class="filter-btn" data-filter="web">Web开发</button>
                            <button class="filter-btn" data-filter="lua">Lua开发</button>
                            <button class="filter-btn" data-filter="python">Python</button>
                            <button class="filter-btn" data-filter="tutorial">教程</button>
                            <button class="filter-btn" data-filter="note">笔记</button>
                        </div>
                    </div>
                </div>

                <div class="articles-section">
                    <h3><i class="fas fa-book-open"></i> 文章列表</h3>
                    <div class="articles-list" id="articlesList">
                        <div class="loading-articles">
                            <div class="loading-spinner"></div>
                            <p>正在加载文章列表...</p>
                        </div>
                    </div>
                </div>
            </section>

            <aside class="cta-section">
                <a href="index.html" class="btn">
                    <i class="fas fa-home"></i> 返回首页
                </a>
                
                <a href="https://github.com/npp-zep" target="_blank" class="btn">
                    <i class="fab fa-github"></i> GitHub 主页
                </a>
                
                <div class="quick-links">
                    <h4>快速链接</h4>
                    <a href="#articles" class="quick-link">查看文章</a>
                    <a href="#about" class="quick-link">关于本站</a>
                    <a href="https://github.com/npp-zep/npp-zep.github.io" target="_blank" class="quick-link">源代码</a>
                </div>
                
                <div class="stats-section" id="statsSection">
                </div>
            </aside>
        </main>

        <footer>
            <p>遵循 <a href="https://opensource.org/licenses/MIT" target="_blank" class="license-link">MIT 协议</a></p>
            <p class="footer-note">文章内容采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议</p>
        </footer>
    </div>

    <div class="markdown-viewer" id="markdownViewer">
        <div class="markdown-header">
            <button class="back-btn" id="backBtn">
                <i class="fas fa-arrow-left"></i> 返回文章列表
            </button>
            <h2 class="markdown-title" id="markdownTitle"></h2>
            <div class="markdown-actions">
                <button class="action-btn" id="toggleSidebarBtn">
                    <i class="fas fa-bars"></i> 目录
                </button>
                <button class="action-btn" id="themeToggleBtn">
                    <i class="fas fa-palette"></i> 主题
                </button>
                <button class="action-btn" id="copyBtn">
                    <i class="far fa-copy"></i> 复制
                </button>
            </div>
        </div>
        
        <div class="markdown-container">
            <div class="markdown-sidebar" id="markdownSidebar">
                <h3 class="toc-title"><i class="fas fa-list"></i> 目录</h3>
                <ul class="toc-list" id="tocList">
                </ul>
                
                <div class="theme-options">
                    <h4><i class="fas fa-palette"></i> 代码主题</h4>
                    <select class="theme-select" id="codeThemeSelect">
                        <option value="github-dark">GitHub Dark</option>
                        <option value="github">GitHub Light</option>
                        <option value="vs2015">VS 2015</option>
                        <option value="atom-one-dark">Atom One Dark</option>
                        <option value="monokai">Monokai</option>
                        <option value="solarized-dark">Solarized Dark</option>
                    </select>
                </div>
            </div>
            
            <div class="markdown-content" id="markdownContent">
            </div>
        </div>
    </div>

    <button class="theme-switcher" id="themeSwitcher">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/markdown.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="script/rendermd.js"></script>
    
    <script>
        const ARTICLES_CONFIG_URL = 'assets/passage/articles.json';
        const ARTICLES_BASE_URL = 'assets/passage/';
        let allArticles = [];

        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loading').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 500);
            }, 800);
            
            loadArticles();
            initThemeSwitcher();
            initBackgroundToggle();
            initMarkdownViewer();
        });

        async function loadArticles() {
            const articlesList = document.getElementById('articlesList');
            
            try {
                articlesList.innerHTML = `
                    <div class="loading-articles">
                        <div class="loading-spinner"></div>
                        <p>正在加载文章列表...</p>
                    </div>
                `;
                
                console.log('正在加载文章配置文件:', ARTICLES_CONFIG_URL);
                
                const response = await fetch(ARTICLES_CONFIG_URL, {
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态: ${response.status} - ${response.statusText}`);
                }
                
                const jsonText = await response.text();
                const cleanJsonText = jsonText.trim().replace(/^\uFEFF/, '');
                const articlesData = JSON.parse(cleanJsonText);
                
                allArticles = articlesData.articles || [];
                
                if (!Array.isArray(allArticles) || allArticles.length === 0) {
                    throw new Error('文章数据格式错误或为空');
                }
                
                articlesList.innerHTML = '';
                
                allArticles.forEach(article => {
                    const articleElement = createArticleCard(article);
                    articlesList.appendChild(articleElement);
                });
                
                updateStats();
                initFilter();
                
                console.log('成功加载', allArticles.length, '篇文章');
                
            } catch (error) {
                console.error('加载文章失败:', error);
                showError('无法加载文章列表', error.message);
            }
        }

        function showError(title, message) {
            const articlesList = document.getElementById('articlesList');
            
            articlesList.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>${title}</h3>
                    <p>${message}</p>
                    <p style="font-size: 0.85rem; margin-top: 1rem;">请检查文件路径是否正确，并确保 <code>articles.json</code> 文件存在。</p>
                    <button onclick="loadArticles()" class="article-btn" style="margin-top: 1rem;">
                        <i class="fas fa-redo"></i> 重试加载
                    </button>
                </div>
            `;
            
            document.getElementById('statsSection').innerHTML = '';
        }

        function createArticleCard(article) {
            const articleCard = document.createElement('div');
            articleCard.className = 'article-card';
            articleCard.dataset.tags = article.tags.join(' ');
            
            const tagsHtml = article.tags.map(tag => 
                `<span class="article-tag tag-${tag}">${tag}</span>`
            ).join('');
            
            articleCard.innerHTML = `
                <div class="article-header">
                    <h4 class="article-title">${article.title}</h4>
                    <div class="article-meta">
                        <span class="article-date"><i class="far fa-calendar"></i> ${article.date}</span>
                        <span class="article-read-time"><i class="far fa-clock"></i> ${article.readTime}</span>
                    </div>
                </div>
                <p class="article-description">${article.description}</p>
                <div class="article-footer">
                    <div class="article-tags">
                        ${tagsHtml}
                    </div>
                    <div class="article-actions">
                        <button class="article-btn read-btn" onclick="openArticle('${article.file}', '${article.title}')">
                            <i class="fas fa-book-open"></i> 阅读
                        </button>
                        <button class="article-btn download-btn" onclick="downloadArticle('${article.file}')">
                            <i class="fas fa-download"></i> 下载
                        </button>
                    </div>
                </div>
            `;
            
            return articleCard;
        }

        function initFilter() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            const articlesList = document.getElementById('articlesList');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.dataset.filter;
                    const articleCards = document.querySelectorAll('.article-card');
                    
                    articleCards.forEach(card => {
                        if (filter === 'all' || card.dataset.tags.includes(filter)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                    
                    articlesList.style.opacity = '0.5';
                    setTimeout(() => {
                        articlesList.style.opacity = '1';
                    }, 300);
                });
            });
        }

        function updateStats() {
            const statsSection = document.getElementById('statsSection');
            
            if (!allArticles || allArticles.length === 0) {
                statsSection.innerHTML = '';
                return;
            }
            
            const totalArticles = allArticles.length;
            const webArticles = allArticles.filter(a => a.tags && a.tags.includes('web')).length;
            const luaArticles = allArticles.filter(a => a.tags && a.tags.includes('lua')).length;
            const pythonArticles = allArticles.filter(a => a.tags && a.tags.includes('python')).length;
            
            statsSection.innerHTML = `
                <div class="stats-card">
                    <h4><i class="fas fa-chart-bar"></i> 文章统计</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number">${totalArticles}</span>
                            <span class="stat-label">总文章数</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">${webArticles}</span>
                            <span class="stat-label">Web开发</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">${luaArticles}</span>
                            <span class="stat-label">Lua开发</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">${pythonArticles}</span>
                            <span class="stat-label">Python</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function initMarkdownViewer() {
            const backBtn = document.getElementById('backBtn');
            const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
            const copyBtn = document.getElementById('copyBtn');
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            const codeThemeSelect = document.getElementById('codeThemeSelect');
            const markdownViewer = document.getElementById('markdownViewer');
            const markdownSidebar = document.getElementById('markdownSidebar');
            
            backBtn.addEventListener('click', () => {
                markdownViewer.style.display = 'none';
            });
            
            toggleSidebarBtn.addEventListener('click', () => {
                markdownSidebar.classList.toggle('hidden');
            });
            
            copyBtn.addEventListener('click', () => {
                const content = document.getElementById('markdownContent').innerText;
                navigator.clipboard.writeText(content).then(() => {
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> 已复制';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                    }, 2000);
                });
            });
            
            codeThemeSelect.addEventListener('change', (e) => {
                const theme = e.target.value;
                changeCodeTheme(theme);
                localStorage.setItem('codeTheme', theme);
            });
            
            const savedTheme = localStorage.getItem('codeTheme') || 'github-dark';
            codeThemeSelect.value = savedTheme;
            changeCodeTheme(savedTheme);
            
            themeToggleBtn.addEventListener('click', () => {
                markdownSidebar.classList.remove('hidden');
            });
        }

        function changeCodeTheme(theme) {
            const link = document.querySelector('link[href*="highlight.js"]');
            if (link) {
                const newTheme = theme === 'github' ? 'github.min.css' : `${theme}.min.css`;
                link.href = `https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/${newTheme}`;
            }
        }

        async function openArticle(filename, title) {
            const markdownViewer = document.getElementById('markdownViewer');
            const markdownTitle = document.getElementById('markdownTitle');
            const markdownContent = document.getElementById('markdownContent');
            
            markdownContent.innerHTML = '<div style="text-align: center; padding: 3rem;"><div class="loading-spinner"></div><p style="margin-top: 1rem;">加载文章中...</p></div>';
            markdownViewer.style.display = 'flex';
            markdownTitle.textContent = title;
            
            try {
                const response = await fetch(`${ARTICLES_BASE_URL}${filename}`);
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态: ${response.status}`);
                }
                const markdown = await response.text();
                
                // 等待renderMarkdown函数可用
                if (typeof window.renderMarkdown !== 'function') {
                    // 如果rendermd.js还没加载，等待一下
                    await new Promise(resolve => {
                        const check = setInterval(() => {
                            if (typeof window.renderMarkdown === 'function') {
                                clearInterval(check);
                                resolve();
                            }
                        }, 100);
                        setTimeout(() => {
                            clearInterval(check);
                            resolve();
                        }, 3000);
                    });
                }
                
                if (typeof window.renderMarkdown === 'function') {
                    const renderedHtml = window.renderMarkdown(markdown, { highlightCode: true });
                    markdownContent.innerHTML = renderedHtml;
                } else {
                    // 如果renderMarkdown不可用，使用简单的markdown渲染
                    markdownContent.innerHTML = renderSimpleMarkdown(markdown);
                }
                
                generateTOC();
                if (window.hljs) {
                    hljs.highlightAll();
                }
            } catch (error) {
                console.error('加载Markdown失败:', error);
                markdownContent.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>加载失败</h3>
                        <p>无法加载文章内容: ${error.message}</p>
                        <button onclick="downloadArticle('${filename}')" class="action-btn" style="margin-top: 1rem;">
                            <i class="fas fa-download"></i> 下载原始文件
                        </button>
                    </div>
                `;
            }
        }

        // 简单的markdown渲染函数，作为备选方案
        function renderSimpleMarkdown(markdown) {
            // 转换标题
            let html = markdown
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^#### (.*$)/gm, '<h4>$1</h4>')
                .replace(/^##### (.*$)/gm, '<h5>$1</h5>')
                .replace(/^###### (.*$)/gm, '<h6>$1</h6>')
                // 转换加粗
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/__(.*?)__/g, '<strong>$1</strong>')
                // 转换斜体
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/_(.*?)_/g, '<em>$1</em>')
                // 转换代码块
                .replace(/```(\w+)?\n([\s\S]*?)```/g, function(match, lang, code) {
                    return `<pre><code class="${lang || ''}">${escapeHtml(code)}</code></pre>`;
                })
                // 转换行内代码
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                // 转换链接
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                // 转换图片
                .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">')
                // 转换列表
                .replace(/^\s*\*\s+(.*$)/gm, '<li>$1</li>')
                .replace(/^\s*-\s+(.*$)/gm, '<li>$1</li>')
                .replace(/^\s*\+\s+(.*$)/gm, '<li>$1</li>')
                // 转换引用
                .replace(/^>\s*(.*$)/gm, '<blockquote>$1</blockquote>')
                // 转换段落
                .replace(/\n\n+/g, '</p><p>')
                .replace(/^([^<\n].*)/gm, '<p>$1</p>');
            
            // 处理列表
            html = html.replace(/<li>.*?<\/li>/g, function(match) {
                if (!match.includes('</ul>') && !match.includes('</ol>')) {
                    return '<ul>' + match + '</ul>';
                }
                return match;
            });
            
            return html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function generateTOC() {
            const content = document.getElementById('markdownContent');
            const tocList = document.getElementById('tocList');
            const headings = content.querySelectorAll('h1, h2, h3, h4');
            
            tocList.innerHTML = '';
            
            if (headings.length === 0) {
                tocList.innerHTML = '<li class="toc-item"><span class="toc-link">暂无目录</span></li>';
                return;
            }
            
            headings.forEach((heading, index) => {
                if (!heading.id) {
                    heading.id = `heading-${index}`;
                }
                
                const level = parseInt(heading.tagName.substring(1));
                const listItem = document.createElement('li');
                listItem.className = `toc-item toc-level-${level}`;
                
                const link = document.createElement('a');
                link.href = `#${heading.id}`;
                link.className = 'toc-link';
                link.textContent = heading.textContent;
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    heading.scrollIntoView({ behavior: 'smooth' });
                });
                
                listItem.appendChild(link);
                tocList.appendChild(listItem);
            });
        }

        function downloadArticle(filename) {
            const link = document.createElement('a');
            link.href = `${ARTICLES_BASE_URL}${filename}`;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function initThemeSwitcher() {
            const themeSwitcher = document.getElementById('themeSwitcher');
            const themeIcon = document.getElementById('themeIcon');
            const html = document.documentElement;
            
            const savedTheme = localStorage.getItem('theme') || 'dark';
            html.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            themeSwitcher.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
                
                themeSwitcher.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    themeSwitcher.style.transform = '';
                }, 200);
            });
            
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-moon';
                } else {
                    themeIcon.className = 'fas fa-sun';
                }
            }
        }

        function initBackgroundToggle() {
            const bgToggle = document.getElementById('bgToggle');
            const bgContainer = document.getElementById('bgContainer');
            
            const bgVisible = localStorage.getItem('bgVisible') !== 'false';
            updateBackgroundVisibility(bgVisible);
            
            bgToggle.addEventListener('click', () => {
                const isVisible = bgContainer.style.opacity !== '0';
                updateBackgroundVisibility(!isVisible);
                localStorage.setItem('bgVisible', !isVisible);
                
                const icon = bgToggle.querySelector('i');
                if (!isVisible) {
                    icon.className = 'fas fa-eye';
                    bgToggle.title = '隐藏背景';
                } else {
                    icon.className = 'fas fa-eye-slash';
                    bgToggle.title = '显示背景';
                }
            });
            
            function updateBackgroundVisibility(visible) {
                if (visible) {
                    bgContainer.style.opacity = '1';
                    bgToggle.title = '隐藏背景';
                    bgToggle.querySelector('i').className = 'fas fa-eye';
                } else {
                    bgContainer.style.opacity = '0';
                    bgToggle.title = '显示背景';
                    bgToggle.querySelector('i').className = 'fas fa-eye-slash';
                }
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.altKey && e.key === 't') {
                document.getElementById('themeSwitcher').click();
            }
            if (e.altKey && e.key === 'b') {
                document.getElementById('bgToggle').click();
            }
            if (e.altKey && e.key === 'h') {
                window.location.href = 'index.html';
            }
            if (e.key === 'Escape') {
                const markdownViewer = document.getElementById('markdownViewer');
                if (markdownViewer.style.display === 'flex') {
                    document.getElementById('backBtn').click();
                }
            }
            if (e.altKey && e.key === 'r') {
                loadArticles();
            }
        });
    </script>
</body>
</html>